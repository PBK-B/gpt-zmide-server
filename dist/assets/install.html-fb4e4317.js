import{r as T,c as V,R as i,aM as G,k as Q,C as U,e as X,t as Y,aE as O,au as $,at as r,aI as Z,aF as B,ay as E,S as L,aJ as ee,az as te,aw as q,a7 as R,av as ae,aK as le,aL as ne}from"./arco-cbef005c.js";function re(a,S){var e,C=a.style,_=a.className,c=a.prefixCls,f=a.index,l=f===void 0?1:f,D=a.current,g=D===void 0?1:D,P=a.status,y=a.title,h=a.description,N=a.icon,k=a.nextStepError,p=a.type,o=a.customDot,n=a.labelPlacement,s=a.disabled,u=a.onClick,b=a.onChange,m=a.direction,t=a.id,x=a.lineless;function w(F){if(p==="dot")return null;var M=l;return N?M=N:F==="finish"?M=i.createElement(G,null):F==="error"&&(M=i.createElement(Q,null)),i.createElement("div",{className:c+"-icon"},M)}function d(F){s||(b&&g!==l&&b(l,t),u&&u(l,t,F))}var v;P?v=P:(g<l&&(v="wait"),g===l&&(v="process"),g>l&&(v="finish"));var I=V(c+"-item",c+"-item-"+v,(e={},e[c+"-item-custom"]=!!N,e[c+"-item-next-error"]=k,e[c+"-item-disabled"]=s,e[c+"-item-active"]=l===g,e),_),K=w(v),A=i.createElement("div",{className:c+"-item-icon"},K),W=o?o(A,{index:l,status:v,title:y,description:h}):A;return i.createElement("div",{ref:S,className:I,style:C,onClick:d},!x&&(n==="vertical"||m==="vertical")&&i.createElement("div",{className:c+"-item-tail"}),p!=="arrow"&&W,i.createElement("div",{className:c+"-item-content"},i.createElement("div",{className:c+"-item-title"},y),h&&i.createElement("div",{className:c+"-item-description"},h)))}var J=T.forwardRef(re);J.displayName="Step";const ie=J;var z=globalThis&&globalThis.__assign||function(){return z=Object.assign||function(a){for(var S,e=1,C=arguments.length;e<C;e++){S=arguments[e];for(var _ in S)Object.prototype.hasOwnProperty.call(S,_)&&(a[_]=S[_])}return a},z.apply(this,arguments)},oe={current:1,type:"default",size:"default",direction:"horizontal",labelPlacement:"horizontal"};function se(a,S){var e,C=T.useContext(U),_=C.getPrefixCls,c=C.componentConfig,f=C.rtl,l=X(a,oe,c==null?void 0:c.Steps),D=l.className,g=l.style,P=l.children,y=l.current,h=y===void 0?1:y,N=l.status,k=l.onChange,p=l.type,o=l.size,n=l.direction,s=l.labelPlacement,u=l.customDot,b=l.lineless,m=_("steps"),t=s;p==="dot"&&(t=n==="vertical"?"horizontal":"vertical"),p==="navigation"&&(t="horizontal");var x=n;(p==="navigation"||p==="arrow")&&(x="horizontal");var w=V(m,m+"-"+x,m+"-label-"+t,m+"-size-"+o,(e={},e[m+"-change-onclick"]=typeof k=="function",e[m+"-mode-"+p]=p!=="default",e[m+"-lineless"]=b,e[m+"-rtl"]=f,e),D);return i.createElement("div",z({ref:S,style:g,className:w},Y(l)),i.Children.toArray(P).filter(function(d){return d&&d.type&&d.type.displayName==="Step"}).map(function(d,v){if(v+=1,d){var I=z({prefixCls:m,type:p,index:v,current:h,status:h===v?N:void 0,customDot:u,labelPlacement:t,direction:x,onChange:k,lineless:b},d.props);return N==="error"&&h===v+1&&(I.nextStepError=!0),i.cloneElement(d,I)}return null}))}var ce=T.forwardRef(se),H=ce;H.displayName="Steps";H.Step=ie;const j=H,de=O.Header;function me(a){return $("div",{className:"app_header",children:[r(de,{style:{height:55,display:"flex",flexDirection:"row"},children:r(Z,{})}),r(B,{style:{margin:0}})]})}function ue(){const[a,S]=i.useState([]),[e,C]=i.useState(1),_=i.useMemo(()=>a[e-1],[a,e]),c=i.useCallback(o=>{const n=e-1,s=a;s[n]={...a[n],...o},S([...s])},[e]),[f,l]=i.useState({loading:!1}),D=(o,n)=>{if(f.loading)return;if(!o||!n){E.warning("请正确填写数据");return}l({...f,loading:!0});const s=new FormData;s.append("step",o),s.append("data",n),te.post("/install/config",s).then(u=>{const{code:b,msg:m,data:t}=u.data;if(l({...f,loading:!1}),b!==200){E.info(m||`请求失败，${b||"稍后重试"}`);return}k()}).catch(u=>{E.error(`请求失败，请稍后重试 ${u}`),l({...f,loading:!1})})},g=[{title:"设置站点信息",view:o=>{const{fromData:n={},setFromData:s=()=>{},onStepPrevious:u=()=>{},onStepNext:b=()=>{}}=o;return r(q,{autoComplete:"off",layout:"vertical",children:[{label:"站点名称",field:"site_name",example:"天真的 ChatGPT 服务"},{label:"站点域名",field:"domain_name",example:"https://example.zmide.com"},{label:"应用端口",field:"port",example:"80"},{label:"管理员用户名",field:"admin_user"},{label:"管理员密码",field:"admin_password"}].map((t,x)=>r(q.Item,{label:t.label,children:r(R,{defaultValue:n[t.field],placeholder:`请输入你的${t.label}${t.example?" ，例如: "+t.example:""}`,onChange:w=>{const d={...n};d[t.field]=w,s(d)}})},`${t.field}_form_item_${x}`))})}},{title:"配置 OpenAI",view:o=>{const{fromData:n,setFromData:s=()=>{},onStepPrevious:u=()=>{},onStepNext:b=()=>{}}=o;return n&&r(q,{autoComplete:"off",layout:"vertical",children:[{label:"OpenAI Secret Key",field:"openai_secret_key",required:!0},{label:"OpenAI Model",field:"openai_model",required:!0},{label:"HTTP 代理地址",field:"openai_proxy_host",example:"192.168.1.1"},{label:"HTTP 代理端口",field:"openai_proxy_port",example:"8081"}].map((t,x)=>r(q.Item,{label:t.label,rules:[t.required?{required:!0}:{}],children:r(R,{defaultValue:n[t.field],placeholder:`请输入你的${t.label}${t.example?" ，例如: "+t.example:""}`,onChange:w=>{const d={...n};d[t.field]=w,s(d)}})},`${t.field}_form_item_${x}`))})}},{title:"配置数据库",view:o=>{const{fromData:n={},setFromData:s=()=>{},onStepPrevious:u=()=>{},onStepNext:b=()=>{}}=o;return r(q,{autoComplete:"off",layout:"vertical",children:[{label:"MySql 数据库地址",field:"mysql_host",example:"127.0.0.1"},{label:"MySql 数据库端口",field:"mysql_port",example:"3306"},{label:"MySql 数据库用户名",field:"mysql_user",example:"root"},{label:"MySql 数据库密码",field:"mysql_password"},{label:"MySql 数据库名称",field:"mysql_database",example:"gpt_zmide_server"}].map((t,x)=>r(q.Item,{label:t.label,children:r(R,{defaultValue:n[t.field],placeholder:`请输入你的${t.label}${t.example?" ，例如: "+t.example:""}`,onChange:w=>{const d={...n};d[t.field]=w,s(d)}})},`${t.field}_form_item_${x}`))})}},{title:"应用部署完成",view:r(ae,{status:"success",title:"你的应用已经完成配置啦!",subTitle:"现在点击完成按钮立即跳转后台管理页面创建应用。"})}],P=i.useMemo(()=>g[e-1].view,[e]),y=i.useMemo(()=>e>=g.length,[e]),h=i.useMemo(()=>e<=1,[e]),N=i.useCallback(()=>{h||C(e-1)},[e,h]),k=i.useCallback(()=>{y||C(e+1)},[e,y]),p=i.useCallback((o,n)=>{if(y){window.location.href="/admin";return}if(n.length<o){E.warning("请填写数据");return}const s=n[o-1];if(!s||Object.keys(s).length<1){E.clear(),E.warning("好像还没填写数据哎？");return}const u=JSON.stringify(s);switch(o){case 1:D("site",u);break;case 2:D("openai",u);break;case 3:D("database",u);break}},[e,a,y]);return $("div",{className:"layout_install",children:[r(me,{}),r(O,{style:{flex:1},children:$(O.Content,{children:[r(j,{current:e,style:{maxWidth:780,margin:"25px auto"},children:g.map((o,n)=>r(j.Step,{title:o.title},n))}),r(B,{}),$("div",{className:"step_container",children:[r("div",{style:{minHeight:410,padding:"30px 0"},children:typeof P=="function"?P({fromData:{..._},setFromData:c,onStepPrevious:N,onStepNext:k}):P}),$("div",{style:{display:"flex",flexDirection:"row",marginBottom:20},children:[r("div",{style:{flex:1}}),h?null:r(L,{type:"outline",style:{marginRight:20},disabled:f.loading,onClick:N,children:"上一步"}),r(L,{type:"primary",onClick:()=>p(e,a),loading:f.loading,disabled:f.loading,children:y?"完成":"下一步"})]})]})]})}),r(ee,{})]})}le.createRoot(document.getElementById("root")).render(r(ne,{children:r(ue,{})}));
